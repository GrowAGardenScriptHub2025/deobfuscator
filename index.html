<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Deobfuscator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        .editor {
            height: 400px;
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
        }
        .log-entry {
            transition: all 0.3s ease;
        }
        .log-entry:hover {
            background-color: #374151;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="container mx-auto p-6 max-w-6xl">
        <h1 class="text-4xl font-bold text-center mb-8 animate-slide-in">Lua Deobfuscator</h1>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Input Section -->
            <div class="animate-slide-in" style="animation-delay: 0.1s;">
                <label class="block text-lg font-semibold mb-2">Obfuscated Code</label>
                <div id="inputEditor" class="editor"></div>
            </div>
            <!-- Output Section -->
            <div class="animate-slide-in" style="animation-delay: 0.2s;">
                <label class="block text-lg font-semibold mb-2">Deobfuscated Code</label>
                <div class="mb-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <p class="font-semibold">Extracted URLs:</p>
                        <ul id="urlList" class="list-disc list-inside text-sm text-gray-300"></ul>
                    </div>
                </div>
                <div id="outputEditor" class="editor"></div>
            </div>
        </div>
        <!-- Logs Section -->
        <div class="animate-slide-in" style="animation-delay: 0.3s;">
            <label class="block text-lg font-semibold mb-2">Logs</label>
            <div id="logs" class="bg-gray-800 p-4 rounded-lg h-32 overflow-y-auto text-sm"></div>
        </div>
        <!-- Deobfuscate Button -->
        <div class="text-center mt-6 animate-slide-in" style="animation-delay: 0.4s;">
            <button id="deobfuscateBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-300">Deobfuscate</button>
        </div>
    </div>

    <script>
        // Initialize ACE editors
        const inputEditor = ace.edit("inputEditor");
        inputEditor.setTheme("ace/theme/monokai");
        inputEditor.session.setMode("ace/mode/lua");
        inputEditor.setOptions({ fontSize: "14px" });

        const outputEditor = ace.edit("outputEditor");
        outputEditor.setTheme("ace/theme/monokai");
        outputEditor.session.setMode("ace/mode/lua");
        outputEditor.setOptions({ fontSize: "14px", readOnly: true });

        // Deobfuscation logic
        function deobfuscate(code) {
            const logs = [];
            let deobfuscated = code;

            // Basic deobfuscation: replace escaped strings and format
            try {
                // Log: Attempt to decode escaped strings
                deobfuscated = deobfuscated.replace(/\\(\d{1,3})/g, (match, num) => {
                    logs.push(`Decoded escape sequence \\${num} to ${String.fromCharCode(parseInt(num))}`);
                    return String.fromCharCode(parseInt(num));
                });

                // Log: Remove unnecessary concatenation
                deobfuscated = deobfuscated.replace(/\.\.\s*['"]\s*['"]/g, "");
                logs.push("Removed unnecessary string concatenations");

                // Log: Format code (basic indentation)
                const lines = deobfuscated.split("\n");
                let indentLevel = 0;
                deobfuscated = lines.map(line => {
                    line = line.trim();
                    if (line.match(/end$/)) indentLevel = Math.max(0, indentLevel - 1);
                    const indented = "  ".repeat(indentLevel) + line;
                    if (line.match(/do$|then$|function.*\)$/)) indentLevel++;
                    return indented;
                }).join("\n");
                logs.push("Applied basic code formatting");
            } catch (e) {
                logs.push(`Error during deobfuscation: ${e.message}`);
            }

            // Extract URLs
            const urlRegex = /https?:\/\/[^\s'"]+/g;
            const urls = deobfuscated.match(urlRegex) || [];
            logs.push(`Extracted ${urls.length} URL(s)`);

            return { deobfuscated, logs, urls };
        }

        // Update logs
        function updateLogs(logs) {
            const logsDiv = document.getElementById("logs");
            logsDiv.innerHTML = logs.map(log => `<div class="log-entry p-2">${log}</div>`).join("");
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Update URL list
        function updateUrls(urls) {
            const urlList = document.getElementById("urlList");
            urlList.innerHTML = urls.length ? urls.map(url => `<li><a href="${url}" target="_blank" class="text-blue-400 hover:underline">${url}</a></li>`).join("") : "<li>No URLs found</li>";
        }

        // Deobfuscate button click handler
        document.getElementById("deobfuscateBtn").addEventListener("click", () => {
            const inputCode = inputEditor.getValue();
            if (!inputCode.trim()) {
                updateLogs(["No input code provided"]);
                return;
            }

            const { deobfuscated, logs, urls } = deobfuscate(inputCode);
            outputEditor.setValue(deobfuscated, -1);
            updateLogs(logs);
            updateUrls(urls);
        });
    </script>
</body>
</html>
